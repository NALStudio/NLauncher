@using MudBlazor.Utilities
@using NLauncher.Index.Models.Index
@using NLauncher.Services.Apps
@using System.Diagnostics
@using NLauncher.Services.Apps.Installing

@inject AppUninstallService UninstallService
@inject IDialogService DialogService

<MudPopover @ref=menu Open="@open" Class="mud-popover-position-override" Style=@popoverStyle AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
    <MudList T="object" Dense>
        <LibraryCardMenuContent ParentMenu="this" Entry="Entry" />
    </MudList>
</MudPopover>

<MudOverlay Visible="@open" AutoClose OnClosed="Close" />

@code {
    [Parameter, EditorRequired]
    public required IndexEntry? Entry { get; set; }

    private MudPopover menu = default!;
    private bool open;
    private string? popoverStyle;

    // The incorrect position should be fixed in the next MudBlazor update
    public void Open(MouseEventArgs args)
    {
        open = true;
        popoverStyle = GetPopoverStyle(args);
        StateHasChanged();
    }

    public void Close()
    {
        open = false;
        StateHasChanged();
    }

    // This should work once a new MudBlazor version is released.
    // see: https://github.com/MudBlazor/MudBlazor/pull/10122
    private string GetPopoverStyle(MouseEventArgs args)
    {
        return $"top: {args.PageY.ToPx()}; left: {args.PageX.ToPx()}";
    }
}